function copyDataAcrossMultipleSheetsAndSpreadsheets() {
  // URL de la hoja de cálculo de destino
  var destinationSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1yCiCgLSm4ZNNah-Rrd8mGm1e10hO430by-oDBuzLruk/edit';
  var destinationSpreadsheet = SpreadsheetApp.openByUrl(destinationSpreadsheetUrl);
  var destinationResumenSheet = destinationSpreadsheet.getSheetByName('Resumen');

  // Poner "En ejecución" en la celda K2 de la hoja Resumen
  destinationResumenSheet.getRange('K2').setValue('En ejecución');

  // URL de la hoja de cálculo de origen
  var sourceSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1M0linoBghADfrfqpVvLPx9ZeDsWowB0ZzMGkfMmMMXQ/edit';
  var sourceSpreadsheet = SpreadsheetApp.openByUrl(sourceSpreadsheetUrl);

  // Mapeos unificados
  var mappings = [
       { sourceSheetName: 'Hoja 1', sourceCell: 'D10:F10', destinationSheetName: 'Resumen', destinationCell: 'A2' },
    { sourceSheetName: 'Hoja 1', sourceCell: 'D13:G13', destinationSheetName: 'Resumen', destinationCell: 'D2' },
    { sourceSheetName: 'Hoja 1', sourceCell: 'D15:G15', destinationSheetName: 'Resumen', destinationCell: 'B2' },
    { sourceSheetName: 'Hoja 1', sourceCell: 'D16:G16', destinationSheetName: 'Resumen', destinationCell: 'C2' },
    { sourceSheetName: 'Hoja 1', sourceCell: 'D19:G19', destinationSheetName: 'Resumen', destinationCell: 'L2' },
    { sourceSheetName: 'Hoja 2', sourceCell: 'P4', destinationSheetName: 'Resumen', destinationCell: 'S2' },
    { sourceSheetName: 'Hoja 2', sourceCell: 'P5', destinationSheetName: 'Resumen', destinationCell: 'R2' },
    { sourceSheetName: 'Hoja 2', sourceCell: 'P6', destinationSheetName: 'Resumen', destinationCell: 'Q2' },
    { sourceSheetName: 'Hoja 2', sourceCell: 'P7', destinationSheetName: 'Resumen', destinationCell: 'T2' },
     { sourceSheetName: 'Hoja 3', sourceCell: 'N13', destinationSheetName: 'Resumen', destinationCell: 'E2' },
      { sourceSheetName: 'Hoja 3', sourceCell: 'N12', destinationSheetName: 'Resumen', destinationCell: 'J2' },
      { sourceSheetName: 'Hoja 3', sourceCell: 'N11', destinationSheetName: 'Resumen', destinationCell: 'I2' },
      { sourceSheetName: 'Hoja 3', sourceCell: 'R5', destinationSheetName: 'Resumen', destinationCell: 'H2' },
      { sourceSheetName: 'Hoja 3', sourceCell: 'R6', destinationSheetName: 'Resumen', destinationCell: 'G2' },
      { sourceSheetName: 'Hoja 3', sourceCell: 'N7', destinationSheetName: 'Resumen', destinationCell: 'F2' },
  ];

  mappings.forEach(function(mapping) {
    var sourceSheet = sourceSpreadsheet.getSheetByName(mapping.sourceSheetName);
    var destinationSheet = destinationSpreadsheet.getSheetByName(mapping.destinationSheetName);
    
    if (!sourceSheet || !destinationSheet) {
      Logger.log('Error: Una de las hojas especificadas no fue encontrada: ' + mapping.sourceSheetName + ' o ' + mapping.destinationSheetName);
      return;
    }

    var sourceRange = sourceSheet.getRange(mapping.sourceCell);
    var destinationRange = destinationSheet.getRange(mapping.destinationCell);

    if (sourceRange.getFormula().includes('=HYPERLINK')) {
      var formula = sourceRange.getFormula();
      destinationRange.setFormula(formula);
    } else {
      var displayValue = sourceRange.getDisplayValues().flat().join(' ');
      destinationRange.setValue(displayValue);
    }
  });

  // Suma de toda la columna D en Hoja 3 y envío del resultado a M en Resumen
  var sheetToSum = sourceSpreadsheet.getSheetByName('Hoja 3');
  if (sheetToSum) {
    var sumRange = sheetToSum.getRange('D1:D' + sheetToSum.getLastRow());
    var sumValues = sumRange.getValues();
    var sum = sumValues.reduce(function(total, row) {
      return total + (parseFloat(row[0]) || 0);
    }, 0);

    var destinationSheetForSum = destinationSpreadsheet.getSheetByName('Resumen');
    if (destinationSheetForSum) {
      var lastDestinationRow = getLastNonEmptyRow(destinationSheetForSum, 'M');
      var destinationCellForSum = destinationSheetForSum.getRange('M' + (lastDestinationRow + 1));
      destinationCellForSum.setValue(sum.toString());
    } else {
      Logger.log('Error: La hoja "Resumen" no fue encontrada en el destino.');
    }
  } else {
    Logger.log('Error: La hoja "Hoja 3" no fue encontrada en el origen.');
  }

  // Copiar datos de la columna C desde C4 de Hoja 3 a C en Detalle HUs
  var sourceColumnSheet = sourceSpreadsheet.getSheetByName('Hoja 3');
  var lastRow = sourceColumnSheet ? sourceColumnSheet.getLastRow() : 0;

  if (sourceColumnSheet) {
    var sourceColumnRangeC = sourceColumnSheet.getRange('C4:C' + lastRow);
    var sourceValuesC = sourceColumnRangeC.getValues();
    var sourceColumnRangeB = sourceColumnSheet.getRange('B4:B' + lastRow);
    var sourceValuesB = sourceColumnRangeB.getValues();
    var sourceColumnRangeG = sourceColumnSheet.getRange('G4:G' + lastRow);
    var sourceValuesG = sourceColumnRangeG.getValues();
    var sourceColumnRangeJ = sourceColumnSheet.getRange('J4:J' + lastRow);
    var sourceValuesJ = sourceColumnRangeJ.getValues();

    var destinationColumnSheet = destinationSpreadsheet.getSheetByName('Detalle HUs');
    if (destinationColumnSheet) {
      var lastDestinationRow = getLastNonEmptyRow(destinationColumnSheet, 'C');
      var destinationColumnRangeC = destinationColumnSheet.getRange('C' + (lastDestinationRow + 1) + ':C' + (lastDestinationRow + sourceValuesC.length));
      destinationColumnRangeC.setValues(sourceValuesC);
      var destinationColumnRangeB = destinationColumnSheet.getRange('D' + (lastDestinationRow + 1) + ':D' + (lastDestinationRow + sourceValuesB.length));
      destinationColumnRangeB.setValues(sourceValuesB);
      var destinationColumnRangeG = destinationColumnSheet.getRange('E' + (lastDestinationRow + 1) + ':E' + (lastDestinationRow + sourceValuesG.length));
      destinationColumnRangeG.setValues(sourceValuesG);
      var destinationColumnRangeJ = destinationColumnSheet.getRange('H' + (lastDestinationRow + 1) + ':H' + (lastDestinationRow + sourceValuesJ.length));
      destinationColumnRangeJ.setValues(sourceValuesJ);

      // Repetir datos de D10:G10 en B tantas veces como filas copiadas
      var sourceRangeD10G10 = sourceSpreadsheet.getSheetByName('Hoja 1').getRange('D10:G10');
      var dataFromD10G10 = sourceRangeD10G10.getDisplayValues().flat().join(' ');
      var repeatValuesD10G10 = Array(sourceValuesC.length).fill([dataFromD10G10]);
      var destinationRangeB = destinationColumnSheet.getRange('B' + (lastDestinationRow + 1) + ':B' + (lastDestinationRow + repeatValuesD10G10.length));
      destinationRangeB.setValues(repeatValuesD10G10);

      // Repetir datos de D19:G19 en A tantas veces como filas copiadas
      var sourceRangeD19G19 = sourceSpreadsheet.getSheetByName('Hoja 1').getRange('D19:G19');
      var dataFromD19G19 = sourceRangeD19G19.getDisplayValues().flat().join(' ');
      var repeatValuesD19G19 = Array(sourceValuesC.length).fill([dataFromD19G19]);
      var destinationRangeA = destinationColumnSheet.getRange('A' + (lastDestinationRow + 1) + ':A' + (lastDestinationRow + repeatValuesD19G19.length));
      destinationRangeA.setValues(repeatValuesD19G19);

      // Repetir datos de D17:G17 en F tantas veces como filas copiadas
      var sourceRangeD17G17 = sourceSpreadsheet.getSheetByName('Hoja 1').getRange('D17:G17');
      var dataFromD17G17 = sourceRangeD17G17.getDisplayValues().flat().join(' ');
      var repeatValuesD17G17 = Array(sourceValuesC.length).fill([dataFromD17G17]);
      var destinationRangeF = destinationColumnSheet.getRange('F' + (lastDestinationRow + 1) + ':F' + (lastDestinationRow + repeatValuesD17G17.length));
      destinationRangeF.setValues(repeatValuesD17G17);

      // Repetir datos de D18:G18 en G tantas veces como filas copiadas
      var sourceRangeD18G18 = sourceSpreadsheet.getSheetByName('Hoja 1').getRange('D18:G18');
      var dataFromD18G18 = sourceRangeD18G18.getDisplayValues().flat().join(' ');
      var repeatValuesD18G18 = Array(sourceValuesC.length).fill([dataFromD18G18]);
      var destinationRangeG = destinationColumnSheet.getRange('G' + (lastDestinationRow + 1) + ':G' + (lastDestinationRow + repeatValuesD18G18.length));
      destinationRangeG.setValues(repeatValuesD18G18);
    } else {
      Logger.log('Error: La hoja "Detalle HUs" no fue encontrada en el destino.');
    }
  } else {
    Logger.log('Error: La hoja "Hoja 3" no fue encontrada en el origen.');
  }
}

function getLastNonEmptyRow(sheet, column) {
  var lastRow = sheet.getLastRow();
  var range = sheet.getRange(column + '1:' + column + lastRow);
  var values = range.getValues();
  for (var i = values.length - 1; i >= 0; i--) {
    if (values[i][0] !== "") {
      return i + 1;
    }
  }
  return 0;
}
